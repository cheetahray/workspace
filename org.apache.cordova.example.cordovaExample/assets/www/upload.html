<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0"/>
<title>數位藝術節</title>
<link href="css/reset.css" media="all" rel="stylesheet" type="text/css" />    
<link href="css/main.css" media="all" rel="stylesheet" type="text/css" />
 <script type="text/javascript" src="jquery-1.6.4.min.js"></script>  
    <script type="text/javascript" charset="utf-8" src="cordova-1.8.1.js"></script>

 <script type="text/javascript">           

$(document).ready(
    function() 
    {
	
	    //$("body").css("display", "none");

        //$("body").fadeIn(1000);
    
	    $('#takePicture').bind("click", function() {
      		takePicture();
   		});
   		$('#selectPicture').bind("click", function() {
      		selectPicture();
   		});
   		$('#uploadPicture').bind("click", function() {
      		uploadPicture();
   		});
    }
);

    function takePicture() {
	   navigator.camera.getPicture(
	   function(imageURI) {
	      $('#camera_image').attr('style', "width:250px");//img.style = "width:200px";
	      var img = document.getElementById('camera_image');
          img.src = imageURI;
	      $('#camera_status').html("成功照相...");
	   },
	   function(e) {
	      $('#camera_status').html("照相失敗...");
	   },
	   {  quality: 50, 
          destinationType: Camera.DestinationType.FILE_URI
	   });
	}

	function selectPicture() {
	   navigator.camera.getPicture(
	   function(imageURI) {
	      $('#camera_image').attr('src', imageURI);
          $('#camera_image').attr('style', "width:250px");
	      $('#camera_status').html("成功選擇圖片...");
	   },
	   function(e) {
	      $('#camera_status').html("選擇圖片失敗...");
	   },
	   {  quality: 50, 
	      destinationType: Camera.DestinationType.FILE_URI, 
	      sourceType: Camera.PictureSourceType.PHOTOLIBRARY
	   });
	}

	function uploadPicture() {
	   // 取得上傳圖片的URI
	   var img = document.getElementById('camera_image');
	   var imageURI = img.src;
       if (imageURI) {  // 有圖片    
	      server = $('#serverUrl').val();  // 取得上傳網址 
	      if (server) {  // 建立FileUploadOptions物件
	         var options = new FileUploadOptions();
	         options.fileKey = "file";
	         options.fileName = imageURI.substr(imageURI.lastIndexOf('/')+1);
	         options.mimeType = "image/jpeg";
	         var params = new Object(); // 建立參數物件
	         var idVal = localStorage.getItem("id");
                                if(null == idVal)
                                {
                                    console.log(idVal);
                                    idVal = "";
                                }
                                params.id = idVal;
	         params.text = $('#takeText').val();
	         options.params = params;
	         options.chunkedMode = false;
	         var ft = new FileTransfer();   // 上傳檔案
             //$('#camera_status').text(imageURI + server);
             ft.upload(imageURI, server, onSuccess, onFail, options);
	      }
	   }
	   else  $('#camera_status').html("請照相或選擇圖片...");  
	}

	function onSuccess(r) {
	        $('#camera_status').html("上傳成功: " + r.bytesSent + "位元組");              
                        if("0" != r.response)
                        {
                            console.log(r.response);
                            localStorage.setItem("id",r.response);
                        }
            //event.preventDefault();
		    $("body").fadeOut(1000, redirectPage);		
	}

	function onFail(error) {
       var raycode;
       switch(error.code)
       {
           case FileTransferError.FILE_NOT_FOUND_ERR:
                raycode = "沒發現檔案";
           break;
           case FileTransferError.INVALID_URL_ERR:
                raycode = "伺服器連結有問題";
           break;
           case FileTransferError.CONNECTION_ERR:
                raycode = "網路訊號極差";
           break;
       }
	   $('#camera_status').html("上傳失敗: " + raycode);             
	}	    

        function redirectPage() {
		    window.location = "game.html";
	    }	
</script>

</head>

<body>

<header style="width:100%; height:10%"><img src="images/logo.png" width="208"/><a href="index.html" class="home"></a> </header>

<div class="wrapper"  style="padding-top:15px;">

<p style=" font-size:93.8%; line-height:1.6; margin-bottom:8px;">恭喜您集滿11個數位藝術足跡，請寫下您的願望並上傳照片，Info Tree將會播放。</p>

<textarea name="" class="textarea" placeholder="請輸入您的願望"></textarea>

<input id="serverUrl" type="hidden" value="http://ftp.daf.org.tw/upload.php"/>

<div id="selectPicture" class="upload"><a href="#"><span></span>相簿</a><div class="space"></div></div> 
<div id="takePicture" class="takepic"><a href="#"><span></span>拍照</a></div>
<div class="space"></div>
<div id="uploadPicture" class="go2"><a href="#"><span></span>確定發送</a></div> 
<p><div id="camera_status"></div></p>
<p><img style="width:0px" id="camera_image" src=""/></p>    

</div>
</body>
</html>
