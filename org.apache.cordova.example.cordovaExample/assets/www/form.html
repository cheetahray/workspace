<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0"/>
<title>數位藝術節</title>
<link href="css/reset.css" media="all" rel="stylesheet" type="text/css" />    
<link href="css/main.css" media="all" rel="stylesheet" type="text/css" />
<script src="jquery-1.6.4.min.js"></script>
<script type="text/javascript" charset="utf-8" src="cordova-1.8.1.js"></script>
                <script type="text/javascript" charset="utf-8" src="childbrowser.js"></script>
                <script type="text/javascript" charset="utf-8" src="FBConnect.js"></script>
                <script type="text/javascript" charset="utf-8" src="json2-min.js"></script>
     
 <script type="text/javascript">           
                    var fbPlugin;
                    var client_id = "293327944111580";
                    var redir_url = "https://www.facebook.com/connect/login_success.html";

    function onBodyLoad()
	{	
        document.addEventListener("deviceready", onDeviceReady, false);
        
    }
	          
                    function onFBConnected()
                    {
                       var url = "https://graph.facebook.com/me?access_token=" + this.accessToken;
	                   var req = new XMLHttpRequest();
	
	                   req.open("get",url,true);
	                   req.onreadystatechange = function() { //Call a function when the state
                            if(req.readyState == 4 && req.status == 200) {
                                onGotMe(req.responseText);
                            }
                       };
                       req.send(null);
                       req.onerror = function(){alert("Error");};
	                }

                    function onGotMe(evt)
                    {
                        var json = JSON.parse(evt);
                        $('#fbid').val(json.id);
                        $('#name').val(json.name);
                        $('#email').val(json.email);

                    }

        function redirect() 
        {
                        var idVal = localStorage.getItem("id");
                        if(null == idVal)
                        {
                            idVal = "";
                        }
                        
                        var nameVal = $('#name').val();
                        var fbid = $('#fbid').val();
                        var email = $('#email').val();
                        var tel = $('#tel').val();
                        var address = $('#address').val();
                        
                        $.ajax({
                               type: 'POST',
                               url:  'http://ftp.daf.org.tw/getNamePhone.php',
                               data: { 
                               id : idVal,
                               fbid : fbid,
                               name : nameVal,
                               tel : tel,
                               address : address,
                               email : email
                                },
                               error: function() {
                                    alert("載入網頁錯誤!");
                               },
                               success: function(data) {
                                    if("0" != $(data).find('id').text())
                                    {
                                        console.log($(data).find('id').text());
                                        localStorage.setItem("id", $(data).find('id').text());
                                    }
                                    console.log($(data).find('sql').text());
                                    localStorage.setItem("settle",15);
                                    window.plugins.fbConnect.postFBWall('我在2012年第七屆台北數位藝術節，已集滿15個數位足跡，獲得參加抽獎的機會!', "http://digitalartfestival.tw/daf12/app.html", "http://ftp.daf.org.tw/fbimg.jpg", function() {
                                        
                                        }
                                    );
                                    setTimeout('delayedRedirect("game.html")', 1500);
                               }
                        });
   		}
                    
    function delayedRedirect(url){
        window.location = url;
    }

    function onDeviceReady()
	{
        $.support.cors                 = true;
    
                                         if (typeof(fbPlugin) === 'undefined')
                                         {
                                            fbPlugin = FBConnect.install();
                                         }
                                         fbPlugin.connect(client_id,redir_url,"touch");
                                         fbPlugin.onConnect = onFBConnected;
        
   		$('#msg').ajaxError(function(event, request, settings) {
      		$(this).html('載入網頁錯誤: ' + settings.msg + '!');
   		});

	}
                     
</script>

</head>

<body onload="onBodyLoad()">

<header style="width:100%; height:10%"><img src="images/logo.png" width="208"/><a href="index.html" class="home"></a> </header>

<div class="wrapper"  style="padding:15px 0;">
<p style=" font-size:14px; line-height:1.6;">恭喜您已集滿15個數位藝術足跡，獲得參加抽獎的機會(共有20個名額)，請填寫您的資料，以便中獎通知，如資料提供不完整，視同放棄得獎資格，謝謝!</p><br/>
姓名：<input id="name" type="text"  class="input" placeholder=" 姓名"/>
連絡電話：<input id="tel" type="text"  class="input" placeholder=" 連絡電話"/>
地址：<input id="address" type="text"  class="input" placeholder=" 地址"/>
E-mail：<input id="email" type="text"  class="input" placeholder=" E-mail"/>
<input id="fbid" type="hidden"  class="input"/>
<div class="go2"><a href="javascript:redirect()">確定發送<span></span></a></div> 
</div>
</body>
</html>
